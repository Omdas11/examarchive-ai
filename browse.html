<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ExamArchive — Browse Papers</title>
  <link rel="stylesheet" href="styles/common.css">
</head>
<body>
  <!-- HEADER -->
  <header class="ea-header">
    <div class="ea-header__left">
      <div class="ea-logo">
        <span class="ea-logo__box">EA</span>
        <div class="ea-title">
          <div class="ea-title__name">ExamArchive</div>
          <div class="ea-title__sub">Old question papers — community</div>
        </div>
      </div>
    </div>

    <div class="ea-header__right">
      <div class="ea-user">
        <span class="ea-user__avatar">G</span>
        <div class="ea-user__meta">
          <div class="ea-user__name">Guest</div>
          <div class="ea-user__role">User</div>
        </div>
      </div>

      <nav class="ea-nav" aria-label="Main navigation">
        <a href="index.html">Home</a>
        <a href="browse.html">Browse</a>
        <a href="upload.html">Upload</a>
        <a href="about.html">About</a>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main class="container" style="padding:28px 0;">
    <h1 style="margin-bottom:12px;">Browse papers</h1>
    <div id="papers-wrap" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px;">
      <!-- cards rendered by script -->
    </div>

    <div id="browse-msg" style="margin-top:18px;color:var(--ea-muted)"></div>
  </main>

  <!-- FOOTER -->
  <footer class="ea-footer">
    <div class="ea-footer__links container">
      <a href="index.html">Home</a>
      <a href="browse.html">Browse</a>
      <a href="upload.html">Upload</a>
      <a href="about.html">About</a>
    </div>
    <div class="container"><p>© 2025 ExamArchive. Built with ❤️ by Om Das</p></div>
  </footer>

  <script>
    // mark active
    document.querySelectorAll('.ea-nav a').forEach(a=>{
      const href = a.getAttribute('href');
      if(location.pathname.endsWith(href)) a.classList.add('active');
    });

    // load papers.json (path: papers/papers.json)
    async function loadPapers(){
      const wrap = document.getElementById('papers-wrap');
      const msg = document.getElementById('browse-msg');
      try{
        const res = await fetch('papers/papers.json', {cache:'no-store'});
        if(!res.ok) throw new Error('Failed to fetch');
        const data = await res.json();
        if(!Array.isArray(data) || data.length === 0){
          msg.textContent = 'No papers found yet.';
          return;
        }
        data.forEach(item=>{
          const a = document.createElement('a');
          a.className = 'ea-card';
          a.href = item.url || ('papers/' + item.file);
          a.target = '_blank';
          a.style.display = 'block';
          a.style.textDecoration = 'none';
          a.style.color = 'inherit';
          a.innerHTML = `
            <div style="display:flex;gap:12px;align-items:center;">
              <div style="width:64px;height:64px;border-radius:10px;background:#fafafa;display:flex;align-items:center;justify-content:center;border:1px solid rgba(0,0,0,0.03);">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M6 2h8l4 4v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z" stroke="#ccc" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </div>
              <div style="flex:1;">
                <div style="font-weight:700;">${item.title || item.file || 'Untitled'}</div>
                <div style="font-size:0.86rem;color:var(--ea-muted);margin-top:6px;">
                  ${item.year ? item.year + ' • ' : ''}${item.university ? item.university : ''} ${item.subject ? ' • ' + item.subject : ''}
                </div>
              </div>
            </div>
          `;
          wrap.appendChild(a);
        });
      }catch(err){
        msg.textContent = 'Could not fetch papers (check papers/papers.json).';
        console.error(err);
      }
    }
    loadPapers();
  </script>
</body>
</html>
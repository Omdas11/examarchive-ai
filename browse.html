<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Browse | ExamArchive</title>
<style>
:root {
  --accent: #d32f2f;
  --bg: #f7f7f8;
  --card: #fff;
  --text: #111;
  --muted: #666;
}
body { margin:0; background:var(--bg); font-family: Inter, system-ui, sans-serif; color:var(--text); }
header {
  background:#222; color:#fff; padding:10px 20px;
  display:flex; align-items:center; justify-content:space-between;
}
header h1 { margin:0; font-size:1.1rem; letter-spacing:0.5px; }
nav a {
  color:#fff; text-decoration:none; margin-left:14px; font-size:14px;
}
nav a:hover { text-decoration:underline; }

.container { max-width:1000px; margin:20px auto; padding:0 15px; }
.controls { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:15px; }
input, select {
  padding:8px 10px; border:1px solid #ddd; border-radius:6px; font-size:14px;
}
button { border:0; background:var(--accent); color:#fff; border-radius:6px; padding:8px 12px; cursor:pointer; }
button:hover { opacity:0.9; }

.grid {
  display:grid; gap:12px;
  grid-template-columns: repeat(auto-fill, minmax(250px,1fr));
}
.card {
  background:var(--card); border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.05);
  padding:12px; display:flex; flex-direction:column; justify-content:space-between;
}
.title { font-weight:600; color:var(--accent); margin-bottom:6px; font-size:15px; }
.meta { color:var(--muted); font-size:13px; margin-bottom:8px; }
.tags { display:flex; flex-wrap:wrap; gap:5px; }
.tag {
  background:#eee; padding:3px 8px; border-radius:20px; font-size:12px; color:var(--text);
}
.save-btn {
  background:none; border:1px solid var(--accent); color:var(--accent);
  border-radius:6px; padding:4px 8px; font-size:13px; cursor:pointer; align-self:flex-start;
}
.save-btn.saved { background:var(--accent); color:#fff; }

footer {
  background:#eee; padding:10px; text-align:center; color:#555; font-size:13px; margin-top:30px;
}
</style>
</head>
<body>

<header>
  <h1>ExamArchive</h1>
  <nav>
    <a href="/index.html">Home</a>
    <a href="/browse.html">Browse</a>
    <a href="/collection.html">Collections</a>
    <a href="/about.html">About</a>
  </nav>
</header>

<div class="container">
  <div class="controls">
    <input id="search" type="search" placeholder="Search papers..." />
    <select id="filter-year"><option value="">All years</option></select>
    <select id="filter-type"><option value="">All types</option></select>
    <button id="clear">Clear</button>
  </div>

  <div id="grid" class="grid"></div>
  <div id="empty" style="text-align:center;color:#777;margin-top:30px;display:none;">No matching papers found.</div>
</div>

<footer>© 2025 ExamArchive | Powered by AI</footer>

<script>
const STORAGE_KEY = "saved_papers";

(async function() {
  const res = await fetch("/mains/paper.json");
  const papers = await res.json();

  const grid = document.getElementById("grid");
  const empty = document.getElementById("empty");
  const search = document.getElementById("search");
  const yearSel = document.getElementById("filter-year");
  const typeSel = document.getElementById("filter-type");
  const clear = document.getElementById("clear");

  const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");

  // populate filter
  [...new Set(papers.map(p => p.year))].sort((a,b)=>b-a)
    .forEach(y => yearSel.innerHTML += `<option value="${y}">${y}</option>`);
  [...new Set(papers.map(p => p.paper_type))].forEach(t => typeSel.innerHTML += `<option value="${t}">${t}</option>`);

  function render(list){
    grid.innerHTML = "";
    if(!list.length){ empty.style.display="block"; return; }
    empty.style.display="none";
    list.forEach(p=>{
      const card = document.createElement("div");
      card.className="card";
      const btn = document.createElement("button");
      btn.className="save-btn";
      btn.textContent = saved.includes(p.id) ? "Saved" : "⭐ Save";
      if(saved.includes(p.id)) btn.classList.add("saved");
      btn.onclick=()=>{
        if(saved.includes(p.id)){
          saved.splice(saved.indexOf(p.id),1);
          btn.classList.remove("saved"); btn.textContent="⭐ Save";
        } else {
          saved.push(p.id);
          btn.classList.add("saved"); btn.textContent="Saved";
        }
        localStorage.setItem(STORAGE_KEY, JSON.stringify(saved));
      };
      card.innerHTML = `
        <div class="title"><a href="${p.file}" target="_blank" style="text-decoration:none;color:var(--accent)">${p.title}</a></div>
        <div class="meta">${p.subject || ""} · ${p.paper_type || ""} · ${p.university || ""} · ${p.year || ""}</div>
        <div class="tags">${(p.tags||[]).map(t=>`<span class='tag'>${t}</span>`).join("")}</div>
      `;
      card.appendChild(btn);
      grid.appendChild(card);
    });
  }

  function filterList(){
    const q = search.value.toLowerCase();
    const year = yearSel.value;
    const type = typeSel.value;
    const filtered = papers.filter(p=>{
      return (!q || (p.title+p.tags.join(" ")+p.university).toLowerCase().includes(q))
        && (!year || p.year == year)
        && (!type || p.paper_type == type);
    });
    render(filtered);
  }

  search.oninput = filterList;
  yearSel.onchange = filterList;
  typeSel.onchange = filterList;
  clear.onclick = ()=>{ search.value=""; yearSel.value=""; typeSel.value=""; render(papers); };

  render(papers);
})();
</script>

</body>
</html>
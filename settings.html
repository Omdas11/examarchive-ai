<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Settings — ExamArchive</title>
<!-- No inline CSS here; page uses common.css -->
<link rel="stylesheet" href="common.css">
</head>
<body>
  <div class="page container">
    <h1>Settings</h1>
    <p class="lead muted">Manage your account, preferences and security. Changes are saved locally here — connect to backend later.</p>

    <div class="settings-shell" id="settingsShell" style="display:grid;grid-template-columns:260px 1fr;gap:18px;">
      <!-- LEFT MENU / TABS -->
      <nav class="menu" aria-label="Settings navigation" style="padding:12px;">
        <div class="logo-mini" style="display:flex;gap:10px;align-items:center;margin-bottom:8px;">
          <img class="logo" src="assets/logo-examarchive.png" alt="" style="height:34px; width:auto; object-fit:contain;"
               data-light="assets/logo-examarchive.png" data-dark="assets/logo-examarchive-dark.png">
          <div>
            <h3>ExamArchive</h3>
            <div class="small muted">Account settings</div>
          </div>
        </div>

        <ul role="tablist" aria-orientation="vertical" style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:6px;">
          <li><button class="tab active" role="tab" data-tab="general" aria-selected="true" style="padding:10px;border-radius:8px;">General</button></li>
          <li><button class="tab" role="tab" data-tab="preferences" style="padding:10px;border-radius:8px;">Preferences</button></li>
          <li><button class="tab" role="tab" data-tab="security" style="padding:10px;border-radius:8px;">Security & Notifications</button></li>
          <li><button class="tab" role="tab" data-tab="advanced" style="padding:10px;border-radius:8px;">Advanced</button></li>
        </ul>
      </nav>

      <!-- RIGHT: CONTENT -->
      <main class="content" style="padding:18px;">
        <!-- General -->
        <section id="tab-general" role="tabpanel">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <h2>General</h2>
            <span class="muted">Account basics & login</span>
          </div>
          <div class="section-body" style="margin-top:12px;">
            <div class="card" style="margin-top:12px;">
              <div style="display:flex; align-items:center; gap:12px;">
                <img src="assets/avatar-placeholder.png" alt="avatar" style="width:68px;height:68px;border-radius:10px; object-fit:cover;">
                <div>
                  <div style="font-weight:700">Om Das</div>
                  <div class="muted">Member since 2024</div>
                  <div class="muted-2" style="margin-top:6px;">No external login connected yet.</div>
                </div>
              </div>

              <form id="generalForm" style="margin-top:12px;">
                <div style="display:flex;gap:12px;margin-bottom:12px;flex-wrap:wrap;">
                  <div style="flex:1;min-width:180px;">
                    <label for="displayName">Display name</label>
                    <input id="displayName" type="text" value="Om Das" />
                  </div>
                  <div style="flex:1;min-width:180px;">
                    <label for="userEmail">Email</label>
                    <input id="userEmail" type="email" value="omdasg11@gmail.com" />
                  </div>
                </div>

                <div style="margin-top:12px; display:flex; gap:8px; align-items:center;">
                  <button class="btn" type="button" onclick="save('general')">Save changes</button>
                  <button class="btn ghost" type="button" onclick="document.getElementById('generalForm').reset()">Reset</button>
                </div>
              </form>
            </div>

            <div style="margin-top:14px;">
              <h3 style="margin:6px 0 8px;">Security</h3>
              <div class="card">
                <div style="display:flex; gap:12px; align-items:center; justify-content:space-between;">
                  <div>
                    <div style="font-weight:700">Password</div>
                    <div class="muted-2">Change your password used for local login.</div>
                  </div>
                  <div>
                    <button class="btn ghost" onclick="alert('Open change password modal')">Change password</button>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </section>

        <!-- Preferences -->
        <section id="tab-preferences" role="tabpanel" hidden>
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <h2>Preferences</h2>
            <span class="muted">Theme, layout and language</span>
          </div>
          <div class="section-body" style="margin-top:12px;">
            <form id="prefForm">
              <div style="display:flex;gap:12px;margin-bottom:12px;flex-wrap:wrap;">
                <div style="flex:1;min-width:180px;">
                  <label for="themeSelect">Theme</label>
                  <select id="themeSelect">
                    <option value="system">System (default)</option>
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                  </select>
                  <div class="muted-2" style="margin-top:6px;">Dark mode will invert the layout and use the dark palette.</div>
                </div>

                <div style="flex:1;min-width:180px;">
                  <label for="defaultView">Default view</label>
                  <select id="defaultView">
                    <option value="grid">Grid</option>
                    <option value="list">List</option>
                    <option value="compact">Compact</option>
                  </select>
                </div>
              </div>

              <div style="display:flex;gap:12px;margin-bottom:12px;flex-wrap:wrap;">
                <div style="flex:1;min-width:180px;">
                  <label for="itemsPerPage">Items per page</label>
                  <select id="itemsPerPage"><option>12</option><option>24</option><option>48</option></select>
                </div>

                <div style="flex:1;min-width:180px;">
                  <label for="lang">Language</label>
                  <select id="lang"><option>English</option><option>অসমীয়া (Assamese)</option></select>
                </div>
              </div>

              <div style="margin-top:12px; display:flex; gap:8px;">
                <button class="btn" type="button" onclick="save('preferences')">Save preferences</button>
                <button class="btn ghost" type="button" onclick="document.getElementById('prefForm').reset()">Reset</button>
              </div>
            </form>
          </div>
        </section>

        <!-- Security & Notifications -->
        <section id="tab-security" role="tabpanel" hidden>
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <h2>Security & Notifications</h2>
            <span class="muted">Protect your account</span>
          </div>
          <div class="section-body" style="margin-top:12px;">
            <div class="card" style="margin-top:12px;">
              <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                  <div style="font-weight:700">Two-factor authentication</div>
                  <div class="muted-2">Add an extra layer — TOTP or SMS (future feature).</div>
                </div>
                <div>
                  <div id="tfaToggle" class="toggle" role="switch" aria-checked="false" onclick="toggleEl(this)"><span class="dot"></span></div>
                </div>
              </div>
            </div>

            <div style="margin-top:12px;" class="card">
              <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                  <div style="font-weight:700">Email notifications</div>
                  <div class="muted-2">Receive emails about new papers, updates and replies.</div>
                </div>
                <div>
                  <div id="emailNotif" class="toggle on" role="switch" aria-checked="true" onclick="toggleEl(this)"><span class="dot"></span></div>
                </div>
              </div>
            </div>

            <div style="margin-top:12px; display:flex; gap:8px; align-items:center;">
              <button class="btn ghost" onclick="alert('Download request: backend required')">Download your data</button>
              <button class="btn ghost" onclick="confirmDelete()">Delete account</button>
            </div>
          </div>
        </section>

        <!-- Advanced (collapsible) -->
        <section id="tab-advanced" role="tabpanel" hidden>
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <h2>Advanced</h2>
            <span class="muted">Developer & import/export</span>
          </div>
          <div class="section-body" style="margin-top:12px;">
            <div class="card" style="margin-top:12px;">
              <div style="display:flex; gap:12px; align-items:center; justify-content:space-between;">
                <div>
                  <div style="font-weight:700">Import / Export</div>
                  <div class="muted-2">Export local settings as JSON (client-side). Import to restore.</div>
                </div>
                <div style="display:flex; gap:8px;">
                  <button class="btn ghost" onclick="exportSettings()">Export</button>
                  <input type="file" id="imFile" style="display:none" onchange="importFile(event)" />
                  <button class="btn ghost" onclick="document.getElementById('imFile').click()">Import</button>
                </div>
              </div>
            </div>

            <div class="muted-2" style="margin-top:10px;">Developer options are disabled by default.</div>
          </div>
        </section>

        <div style="display:flex;justify-content:flex-end;gap:12px;margin-top:18px;">
          <button class="btn ghost" onclick="restoreDefaults()">Restore defaults</button>
          <button class="btn" onclick="save('all')">Save all</button>
        </div>
      </main>
    </div>
  </div>

<script src="common.js" defer></script>
<script>
/* Small settings page script (tabs, toggles, save) */

document.querySelectorAll('.menu .tab').forEach(btn=>{
  btn.addEventListener('click', () => {
    document.querySelectorAll('.menu .tab').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const id = btn.dataset.tab;
    document.querySelectorAll('[role="tabpanel"]').forEach(tp=>tp.hidden = true);
    const el = document.getElementById('tab-' + id);
    if(el) el.hidden = false;
    document.querySelectorAll('[role="tab"]').forEach(t=>t.setAttribute('aria-selected','false'));
    btn.setAttribute('aria-selected','true');
  });
});

function toggleEl(el){
  el.classList.toggle('on');
  const state = el.classList.contains('on');
  el.setAttribute('aria-checked', String(state));
}

function save(section){
  const data = {
    general: {
      name: document.getElementById('displayName')?.value,
      email: document.getElementById('userEmail')?.value
    },
    preferences: {
      theme: document.getElementById('themeSelect')?.value,
      view: document.getElementById('defaultView')?.value
    },
    security: {
      tfa: document.getElementById('tfaToggle')?.classList.contains('on'),
      emailNotif: document.getElementById('emailNotif')?.classList.contains('on')
    }
  };
  localStorage.setItem('exam_settings', JSON.stringify(data));
  alert('Saved (' + section + '). This demo stores settings locally.');
}

function restoreDefaults(){ if(confirm('Restore default settings?')) { localStorage.removeItem('exam_settings'); location.reload(); } }

function exportSettings(){
  const s = localStorage.getItem('exam_settings') || '{}';
  const blob = new Blob([s], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'examarchive-settings.json';
  document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
}

function importFile(e){
  const f = e.target.files?.[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = () => {
    try{
      const data = JSON.parse(r.result);
      localStorage.setItem('exam_settings', JSON.stringify(data));
      alert('Imported settings locally. Reloading.');
      location.reload();
    }catch(err){ alert('Invalid file'); }
  };
  r.readAsText(f);
}

function confirmDelete(){ if(confirm('Delete your account and data? This action cannot be undone.')) { alert('Account deletion must be implemented server-side.'); } }

/* Load saved settings (including theme) */
(function(){
  const s = localStorage.getItem('exam_settings');
  if(s) {
    try{
      const obj = JSON.parse(s);
      if(obj.general){
        document.getElementById('displayName').value = obj.general.name || '';
        document.getElementById('userEmail').value = obj.general.email || '';
      }
      if(obj.preferences){
        if(obj.preferences.theme) document.getElementById('themeSelect').value = obj.preferences.theme;
        if(obj.preferences.view) document.getElementById('defaultView').value = obj.preferences.view;
      }
      if(obj.security){
        const tfa = document.getElementById('tfaToggle');
        const emailN = document.getElementById('emailNotif');
        if(tfa && obj.security.tfa) tfa.classList.add('on');
        if(emailN && obj.security.emailNotif) emailN.classList.add('on');
      }
    }catch(e){}
  }

  // hook theme select to global theme utils (provided in footer.html)
  const sel = document.getElementById('themeSelect');
  if(sel){
    // set initial value from localStorage exam_theme if present
    const savedTheme = localStorage.getItem('exam_theme') || 'system';
    sel.value = savedTheme;
    sel.addEventListener('change', function(e){
      const v = e.target.value;
      if(window.examTheme && typeof window.examTheme.applyTheme === 'function'){
        window.examTheme.applyTheme(v);
      } else {
        // fallback
        if(v === 'dark') document.documentElement.setAttribute('data-theme','dark');
        else document.documentElement.removeAttribute('data-theme');
        localStorage.setItem('exam_theme', v);
      }
    });
  }
})();
</script>
</body>
</html>